on: 
  release:
    types: [published]

jobs:
  update_major_version_tag:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Verify version and get current major version
        id: verify_and_get_v
        run: |
          echo release_tag="${GITHUB_REF##*/}" ## same as ${GITHUB_REF_NAME}
          
          release_version=$(echo $release_tag | sed -e 's/^v//')
          echo current_major_version=$(echo $release_version | cut -d'.' -f1) | tee $GITHUB_OUTPUT
      - name: Update major version
        run: |
          echo $v_major_version
          git push origin :refs/tags/$v_major_version
          git tag $v_major_version $GITHUB_SHA
          git push origin $v_major_version
          echo "Attached tag $v_major_version to commit $GITHUB_SHA."
        env:
          v_major_version: v${{ steps.verify_and_get_v.outputs.current_major_version }}

